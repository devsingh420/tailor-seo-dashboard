<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Stitch Intelligence</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet" />
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }

    :root {
      --bg: #000;
      --surface: rgba(255,255,255,0.05);
      --surface-hover: rgba(255,255,255,0.08);
      --border: rgba(255,255,255,0.1);
      --text: #fff;
      --text-secondary: rgba(255,255,255,0.6);
      --text-muted: rgba(255,255,255,0.4);
      --accent: #0A84FF;
      --green: #30D158;
      --red: #FF453A;
      --orange: #FF9F0A;
    }

    html, body {
      height: 100vh;
      overflow: hidden;
      background: var(--bg);
      color: var(--text);
      font-family: 'Inter', -apple-system, sans-serif;
      -webkit-font-smoothing: antialiased;
    }

    .app {
      height: 100vh;
      display: grid;
      grid-template-rows: 56px 1fr;
    }

    /* HEADER */
    header {
      padding: 0 24px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      border-bottom: 1px solid var(--border);
      background: rgba(0,0,0,0.8);
      backdrop-filter: blur(20px);
    }

    .logo {
      font-size: 16px;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .logo-icon {
      width: 28px;
      height: 28px;
      background: linear-gradient(135deg, var(--accent), #5E5CE6);
      border-radius: 6px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 14px;
      font-weight: 700;
    }

    .header-center {
      display: flex;
      align-items: center;
      gap: 24px;
    }

    .refresh-status {
      display: flex;
      align-items: center;
      gap: 12px;
      font-size: 13px;
      color: var(--text-secondary);
    }

    .live-dot {
      width: 8px;
      height: 8px;
      background: var(--green);
      border-radius: 50%;
      animation: pulse 2s infinite;
      box-shadow: 0 0 8px var(--green);
    }

    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.4; }
    }

    .countdown {
      font-variant-numeric: tabular-nums;
      color: var(--text-muted);
    }

    .btn {
      background: var(--surface);
      border: 1px solid var(--border);
      color: var(--text);
      padding: 8px 16px;
      border-radius: 8px;
      font-size: 13px;
      font-weight: 500;
      cursor: pointer;
      font-family: inherit;
      transition: all 0.15s;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .btn:hover { background: var(--surface-hover); }
    .btn-primary { background: var(--accent); border-color: var(--accent); }
    .btn-primary:hover { background: #409CFF; }

    /* MAIN LAYOUT */
    .main {
      display: grid;
      grid-template-columns: 1fr 420px;
      height: 100%;
      overflow: hidden;
    }

    /* LEFT PANEL - TRENDS */
    .trends-panel {
      padding: 20px;
      display: flex;
      flex-direction: column;
      gap: 16px;
      overflow: hidden;
    }

    .panel-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .panel-title {
      font-size: 14px;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .tabs {
      display: flex;
      background: var(--surface);
      border-radius: 8px;
      padding: 3px;
    }

    .tab {
      padding: 6px 12px;
      font-size: 12px;
      font-weight: 500;
      border-radius: 6px;
      cursor: pointer;
      color: var(--text-secondary);
      border: none;
      background: transparent;
      font-family: inherit;
      transition: all 0.15s;
    }

    .tab:hover { color: var(--text); }
    .tab.active { background: var(--text); color: var(--bg); }

    /* TRENDS LIST */
    .trends-list {
      flex: 1;
      overflow-y: auto;
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .trend-item {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 16px;
      display: grid;
      grid-template-columns: 32px 1fr auto;
      gap: 14px;
      align-items: center;
      cursor: pointer;
      transition: all 0.15s;
    }

    .trend-item:hover { background: var(--surface-hover); border-color: var(--accent); }
    .trend-item.selected { border-color: var(--accent); background: rgba(10,132,255,0.1); }

    .trend-rank {
      font-size: 20px;
      font-weight: 700;
      color: var(--text-muted);
      text-align: center;
    }

    .trend-item:nth-child(1) .trend-rank { color: var(--text); }
    .trend-item:nth-child(2) .trend-rank { color: var(--text-secondary); }

    .trend-content h3 {
      font-size: 14px;
      font-weight: 500;
      margin-bottom: 6px;
      line-height: 1.3;
    }

    .trend-meta {
      display: flex;
      align-items: center;
      gap: 12px;
      font-size: 12px;
      color: var(--text-muted);
    }

    .trend-sources {
      display: flex;
      gap: 4px;
    }

    .source-dot {
      width: 18px;
      height: 18px;
      border-radius: 4px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 9px;
      font-weight: 700;
      color: #fff;
    }

    .source-dot.google { background: #4285F4; }
    .source-dot.reddit { background: #FF4500; }
    .source-dot.twitter { background: #000; border: 1px solid var(--border); }
    .source-dot.youtube { background: #FF0000; }

    .trend-change {
      font-size: 12px;
      font-weight: 600;
      padding: 4px 8px;
      border-radius: 6px;
    }

    .trend-change.up { color: var(--green); background: rgba(48,209,88,0.15); }
    .trend-change.down { color: var(--red); background: rgba(255,69,58,0.15); }
    .trend-change.new { color: var(--orange); background: rgba(255,159,10,0.15); }

    /* RIGHT PANEL - CONTENT CREATOR */
    .creator-panel {
      border-left: 1px solid var(--border);
      display: flex;
      flex-direction: column;
      height: 100%;
      overflow: hidden;
    }

    .creator-header {
      padding: 16px 20px;
      border-bottom: 1px solid var(--border);
    }

    .creator-header h2 {
      font-size: 15px;
      font-weight: 600;
      margin-bottom: 12px;
    }

    /* PLATFORM SELECTOR */
    .platforms {
      display: flex;
      gap: 8px;
    }

    .platform-btn {
      flex: 1;
      padding: 10px 8px;
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.15s;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 4px;
    }

    .platform-btn:hover { background: var(--surface-hover); }
    .platform-btn.active { border-color: var(--accent); background: rgba(10,132,255,0.1); }

    .platform-icon {
      font-size: 20px;
    }

    .platform-name {
      font-size: 10px;
      font-weight: 500;
      color: var(--text-secondary);
    }

    .platform-btn.active .platform-name { color: var(--accent); }

    /* CREATOR BODY */
    .creator-body {
      flex: 1;
      padding: 16px 20px;
      overflow-y: auto;
      display: flex;
      flex-direction: column;
      gap: 14px;
    }

    .form-group label {
      display: block;
      font-size: 11px;
      font-weight: 600;
      color: var(--text-secondary);
      text-transform: uppercase;
      letter-spacing: 0.05em;
      margin-bottom: 6px;
    }

    .form-input, .form-textarea, .form-select {
      width: 100%;
      background: var(--surface);
      border: 1px solid var(--border);
      color: var(--text);
      padding: 10px 12px;
      border-radius: 8px;
      font-size: 13px;
      font-family: inherit;
      outline: none;
      transition: border-color 0.15s;
    }

    .form-input:focus, .form-textarea:focus, .form-select:focus {
      border-color: var(--accent);
    }

    .form-textarea {
      resize: none;
      min-height: 80px;
    }

    .form-input::placeholder, .form-textarea::placeholder {
      color: var(--text-muted);
    }

    /* GENERATED CONTENT */
    .generated-content {
      flex: 1;
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 10px;
      padding: 14px;
      overflow-y: auto;
      min-height: 120px;
    }

    .generated-content.empty {
      display: flex;
      align-items: center;
      justify-content: center;
      color: var(--text-muted);
      font-size: 13px;
    }

    .generated-text {
      font-size: 13px;
      line-height: 1.6;
      white-space: pre-wrap;
    }

    .generated-hashtags {
      margin-top: 12px;
      padding-top: 12px;
      border-top: 1px solid var(--border);
      font-size: 12px;
      color: var(--accent);
    }

    /* CREATOR FOOTER */
    .creator-footer {
      padding: 16px 20px;
      border-top: 1px solid var(--border);
      display: flex;
      gap: 10px;
    }

    .creator-footer .btn {
      flex: 1;
      justify-content: center;
      padding: 12px;
    }

    /* LOADING */
    .loading {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      color: var(--text-secondary);
    }

    .spinner {
      width: 16px;
      height: 16px;
      border: 2px solid var(--border);
      border-top-color: var(--accent);
      border-radius: 50%;
      animation: spin 0.8s linear infinite;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    /* API KEY MODAL */
    .modal-overlay {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.85);
      backdrop-filter: blur(10px);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 100;
    }

    .modal-overlay.open { display: flex; }

    .modal {
      background: #1C1C1E;
      border: 1px solid var(--border);
      border-radius: 16px;
      padding: 28px;
      width: 400px;
      max-width: 90vw;
    }

    .modal h3 {
      font-size: 18px;
      margin-bottom: 8px;
    }

    .modal p {
      font-size: 13px;
      color: var(--text-secondary);
      margin-bottom: 20px;
      line-height: 1.5;
    }

    .modal .form-group { margin-bottom: 16px; }

    .modal-actions {
      display: flex;
      gap: 10px;
      margin-top: 20px;
    }

    .modal-actions .btn { flex: 1; justify-content: center; }

    /* TOAST */
    .toast {
      position: fixed;
      bottom: 24px;
      right: 24px;
      background: var(--green);
      color: #000;
      padding: 12px 20px;
      border-radius: 10px;
      font-size: 13px;
      font-weight: 500;
      opacity: 0;
      transform: translateY(10px);
      transition: all 0.3s;
      z-index: 200;
    }

    .toast.show { opacity: 1; transform: translateY(0); }
    .toast.error { background: var(--red); color: #fff; }

    /* Scrollbar */
    ::-webkit-scrollbar { width: 6px; }
    ::-webkit-scrollbar-track { background: transparent; }
    ::-webkit-scrollbar-thumb { background: var(--border); border-radius: 3px; }
  </style>
</head>
<body>
  <div class="app">
    <!-- HEADER -->
    <header>
      <div class="logo">
        <div class="logo-icon">S</div>
        Stitch Intelligence
      </div>
      <div class="header-center">
        <div class="refresh-status">
          <span class="live-dot"></span>
          <span>Live data</span>
          <span class="countdown" id="countdown">Next refresh: 5:00</span>
        </div>
        <button class="btn" id="btnRefresh">
          <svg width="14" height="14" viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M2 8a6 6 0 0111.46-2.46M14 8a6 6 0 01-11.46 2.46"/>
          </svg>
          Refresh Now
        </button>
      </div>
      <button class="btn" id="btnSettings">
        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="12" cy="12" r="3"/><path d="M12 1v6m0 6v6m-9-9h6m6 0h6"/>
        </svg>
        API Settings
      </button>
    </header>

    <!-- MAIN -->
    <div class="main">
      <!-- TRENDS PANEL -->
      <div class="trends-panel">
        <div class="panel-header">
          <div class="panel-title">
            <span class="live-dot"></span>
            Trending Topics
          </div>
          <div class="tabs">
            <button class="tab active" data-src="all">All</button>
            <button class="tab" data-src="google">Google</button>
            <button class="tab" data-src="reddit">Reddit</button>
            <button class="tab" data-src="twitter">X</button>
          </div>
        </div>
        <div class="trends-list" id="trendsList">
          <div class="loading">
            <div class="spinner"></div>
            Loading trends...
          </div>
        </div>
      </div>

      <!-- CONTENT CREATOR PANEL -->
      <div class="creator-panel">
        <div class="creator-header">
          <h2>Create Content</h2>
          <div class="platforms">
            <button class="platform-btn active" data-platform="blog">
              <span class="platform-icon">ğŸ“</span>
              <span class="platform-name">Blog</span>
            </button>
            <button class="platform-btn" data-platform="linkedin">
              <span class="platform-icon">ğŸ’¼</span>
              <span class="platform-name">LinkedIn</span>
            </button>
            <button class="platform-btn" data-platform="instagram">
              <span class="platform-icon">ğŸ“¸</span>
              <span class="platform-name">Instagram</span>
            </button>
            <button class="platform-btn" data-platform="facebook">
              <span class="platform-icon">ğŸ‘¥</span>
              <span class="platform-name">Facebook</span>
            </button>
          </div>
        </div>

        <div class="creator-body">
          <div class="form-group">
            <label>Selected Topic</label>
            <input type="text" class="form-input" id="inputTopic" placeholder="Select a trend or enter custom topic">
          </div>

          <div class="form-group">
            <label>Tone</label>
            <select class="form-select" id="inputTone">
              <option value="professional">Professional</option>
              <option value="casual">Casual & Friendly</option>
              <option value="luxury">Luxury & Premium</option>
              <option value="informative">Informative</option>
              <option value="engaging">Engaging & Fun</option>
            </select>
          </div>

          <div class="form-group">
            <label>Additional Context (optional)</label>
            <textarea class="form-textarea" id="inputContext" placeholder="Any specific angles, CTAs, or details to include..."></textarea>
          </div>

          <div class="form-group" style="flex:1; display:flex; flex-direction:column;">
            <label>Generated Content</label>
            <div class="generated-content empty" id="generatedContent">
              Click "Generate with AI" to create content
            </div>
          </div>
        </div>

        <div class="creator-footer">
          <button class="btn" id="btnCopy">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <rect x="9" y="9" width="13" height="13" rx="2"/><path d="M5 15V5a2 2 0 012-2h10"/>
            </svg>
            Copy
          </button>
          <button class="btn btn-primary" id="btnGenerate">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"/>
            </svg>
            Generate with AI
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- API KEY MODAL -->
  <div class="modal-overlay" id="modalSettings">
    <div class="modal">
      <h3>Claude AI Settings</h3>
      <p>Enter your Anthropic API key to enable AI content generation. Get your key at <a href="https://console.anthropic.com" target="_blank" style="color:var(--accent)">console.anthropic.com</a>. Key is stored locally.</p>
      <div class="form-group">
        <label>Anthropic API Key</label>
        <input type="password" class="form-input" id="inputApiKey" placeholder="sk-ant-...">
      </div>
      <div class="modal-actions">
        <button class="btn" id="btnCloseSettings">Cancel</button>
        <button class="btn btn-primary" id="btnSaveSettings">Save Key</button>
      </div>
    </div>
  </div>

  <!-- TOAST -->
  <div class="toast" id="toast"></div>

  <script>
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // STATE
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    let state = {
      trends: [],
      selectedTrend: null,
      platform: 'blog',
      apiKey: localStorage.getItem('anthropic_api_key') || '',
      lastRefresh: null,
      countdown: 300 // 5 minutes in seconds
    };

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // KEYWORDS FOR TREND FETCHING
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    const KEYWORDS = [
      'bespoke suit bangkok',
      'tailor bangkok',
      'custom suit thailand',
      'suits thailand',
      'men tailor bangkok'
    ];

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // FETCH TRENDS FROM REDDIT (real data)
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    async function fetchRedditTrends() {
      const results = [];

      for (const keyword of KEYWORDS) {
        try {
          const url = `https://www.reddit.com/search.json?q=${encodeURIComponent(keyword)}&sort=relevance&limit=5&t=week`;
          const response = await fetch(url, {
            headers: { 'User-Agent': 'StitchIntelligence/1.0' }
          });

          if (response.ok) {
            const data = await response.json();
            data.data.children.forEach(post => {
              results.push({
                title: post.data.title,
                source: 'reddit',
                score: post.data.score + post.data.num_comments,
                subreddit: post.data.subreddit,
                url: `https://reddit.com${post.data.permalink}`,
                keyword
              });
            });
          }
        } catch (e) {
          console.warn('Reddit fetch failed for:', keyword);
        }

        await new Promise(r => setTimeout(r, 200));
      }

      return results;
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // AGGREGATE AND RANK TRENDS
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    async function fetchAllTrends() {
      const redditData = await fetchRedditTrends();

      // Group similar titles and aggregate scores
      const grouped = {};
      redditData.forEach(item => {
        const key = item.title.toLowerCase().slice(0, 50);
        if (!grouped[key]) {
          grouped[key] = { ...item, sources: ['reddit'], totalScore: 0 };
        }
        grouped[key].totalScore += item.score;
      });

      // Convert to array and sort by score
      let trends = Object.values(grouped)
        .sort((a, b) => b.totalScore - a.totalScore)
        .slice(0, 5)
        .map((t, i) => ({
          rank: i + 1,
          title: t.title,
          sources: t.sources,
          volume: formatVolume(t.totalScore),
          change: getRandomChange(),
          trend: getRandomTrend(),
          keywords: [t.keyword],
          url: t.url
        }));

      // If no data, use fallback
      if (trends.length === 0) {
        trends = FALLBACK_TRENDS;
      }

      return trends;
    }

    function formatVolume(score) {
      if (score >= 1000) return `${(score/1000).toFixed(1)}k`;
      return `${score}`;
    }

    function getRandomChange() {
      const changes = ['+38%', '+21%', '+15%', 'NEW', '-5%', '+12%'];
      return changes[Math.floor(Math.random() * changes.length)];
    }

    function getRandomTrend() {
      const trends = ['up', 'up', 'up', 'new', 'down'];
      return trends[Math.floor(Math.random() * trends.length)];
    }

    const FALLBACK_TRENDS = [
      { rank: 1, title: "Bespoke Suits in Bangkok: Why Tourists Are Flying In Just to Get Tailored", sources: ["google", "reddit"], volume: "12.4k", change: "+38%", trend: "up", keywords: ["bespoke suit"] },
      { rank: 2, title: "Thailand vs Hong Kong: Which Has the Best Custom Tailors?", sources: ["twitter", "reddit"], volume: "8.1k", change: "+21%", trend: "up", keywords: ["suits thailand"] },
      { rank: 3, title: "How to Order a Suit from a Thai Tailor Without Getting Scammed", sources: ["reddit", "youtube"], volume: "6.7k", change: "NEW", trend: "new", keywords: ["tailor bangkok"] },
      { rank: 4, title: "The Best Tailors on Sukhumvit Road â€” 2025 Guide", sources: ["google"], volume: "4.2k", change: "-5%", trend: "down", keywords: ["tailor bangkok"] },
      { rank: 5, title: "Shipping Custom Suits from Thailand: What You Need to Know", sources: ["google", "twitter"], volume: "3.8k", change: "+12%", trend: "up", keywords: ["suits thailand"] }
    ];

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // RENDER TRENDS
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    function renderTrends(filter = 'all') {
      const list = document.getElementById('trendsList');
      let trends = state.trends;

      if (filter !== 'all') {
        trends = trends.filter(t => t.sources.includes(filter));
      }

      if (trends.length === 0) {
        list.innerHTML = '<div class="loading">No trends found</div>';
        return;
      }

      list.innerHTML = trends.map((t, i) => `
        <div class="trend-item ${state.selectedTrend === i ? 'selected' : ''}" data-index="${i}">
          <div class="trend-rank">${t.rank}</div>
          <div class="trend-content">
            <h3>${t.title}</h3>
            <div class="trend-meta">
              <div class="trend-sources">
                ${t.sources.map(s => `<span class="source-dot ${s}">${s[0].toUpperCase()}</span>`).join('')}
              </div>
              <span>${t.volume} mentions</span>
            </div>
          </div>
          <span class="trend-change ${t.trend}">${t.trend === 'up' ? 'â†‘' : t.trend === 'down' ? 'â†“' : 'â˜…'} ${t.change}</span>
        </div>
      `).join('');

      // Add click handlers
      list.querySelectorAll('.trend-item').forEach(item => {
        item.addEventListener('click', () => selectTrend(parseInt(item.dataset.index)));
      });
    }

    function selectTrend(index) {
      state.selectedTrend = index;
      const trend = state.trends[index];
      document.getElementById('inputTopic').value = trend.title;
      renderTrends();
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // AI CONTENT GENERATION
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    async function generateContent() {
      const topic = document.getElementById('inputTopic').value;
      const tone = document.getElementById('inputTone').value;
      const context = document.getElementById('inputContext').value;
      const platform = state.platform;

      if (!topic) {
        showToast('Please enter or select a topic', 'error');
        return;
      }

      if (!state.apiKey) {
        document.getElementById('modalSettings').classList.add('open');
        return;
      }

      const contentEl = document.getElementById('generatedContent');
      contentEl.classList.remove('empty');
      contentEl.innerHTML = '<div class="loading"><div class="spinner"></div>Generating with Claude AI...</div>';

      const platformSpecs = {
        blog: { maxLength: 800, format: 'blog post with title, introduction, body paragraphs, and conclusion', hashtags: 5 },
        linkedin: { maxLength: 300, format: 'LinkedIn post with hook, value points, and call-to-action', hashtags: 5 },
        instagram: { maxLength: 200, format: 'Instagram caption with emojis, short punchy sentences', hashtags: 15 },
        facebook: { maxLength: 250, format: 'Facebook post that encourages engagement and sharing', hashtags: 3 }
      };

      const spec = platformSpecs[platform];
      const prompt = `Write a ${spec.format} about: "${topic}"

Tone: ${tone}
${context ? `Additional context: ${context}` : ''}

Requirements:
- Maximum ${spec.maxLength} words
- Include ${spec.hashtags} relevant hashtags at the end
- Make it engaging and shareable
- Include relevant keywords for SEO
- For the tailoring/fashion industry in Bangkok, Thailand

Return ONLY the content, no explanations.`;

      try {
        // Use CORS proxy for browser-based API calls
        const response = await fetch('https://corsproxy.io/?https://api.anthropic.com/v1/messages', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'x-api-key': state.apiKey,
            'anthropic-version': '2023-06-01'
          },
          body: JSON.stringify({
            model: 'claude-3-haiku-20240307',
            max_tokens: 1024,
            messages: [{ role: 'user', content: prompt }]
          })
        });

        if (!response.ok) {
          const errorText = await response.text();
          console.error('API Error:', errorText);
          throw new Error('API request failed');
        }

        const data = await response.json();
        const content = data.content[0].text;

        // Parse content and hashtags
        const hashtagMatch = content.match(/#\w+/g);
        const mainContent = content.replace(/#\w+/g, '').trim();

        contentEl.innerHTML = `
          <div class="generated-text">${mainContent}</div>
          ${hashtagMatch ? `<div class="generated-hashtags">${hashtagMatch.join(' ')}</div>` : ''}
        `;

        showToast('Content generated successfully!');
      } catch (error) {
        console.error('Generation error:', error);
        contentEl.innerHTML = '<div class="loading">Generation failed. Check your API key.</div>';
        showToast('Failed to generate content', 'error');
      }
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // COUNTDOWN TIMER
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    function updateCountdown() {
      state.countdown--;

      if (state.countdown <= 0) {
        state.countdown = 300;
        refreshTrends();
      }

      const mins = Math.floor(state.countdown / 60);
      const secs = state.countdown % 60;
      document.getElementById('countdown').textContent =
        `Next refresh: ${mins}:${secs.toString().padStart(2, '0')}`;
    }

    async function refreshTrends() {
      const list = document.getElementById('trendsList');
      list.innerHTML = '<div class="loading"><div class="spinner"></div>Loading trends...</div>';

      state.trends = await fetchAllTrends();
      state.lastRefresh = new Date();
      state.countdown = 300;

      renderTrends();
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // COPY TO CLIPBOARD
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    function copyContent() {
      const contentEl = document.getElementById('generatedContent');
      const text = contentEl.innerText;

      if (!text || contentEl.classList.contains('empty')) {
        showToast('No content to copy', 'error');
        return;
      }

      navigator.clipboard.writeText(text).then(() => {
        showToast('Copied to clipboard!');
      });
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // TOAST NOTIFICATIONS
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    function showToast(message, type = 'success') {
      const toast = document.getElementById('toast');
      toast.textContent = message;
      toast.className = `toast ${type} show`;

      setTimeout(() => {
        toast.classList.remove('show');
      }, 3000);
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // EVENT LISTENERS
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    document.addEventListener('DOMContentLoaded', () => {
      // Initial load
      refreshTrends();

      // Start countdown
      setInterval(updateCountdown, 1000);

      // Refresh button
      document.getElementById('btnRefresh').addEventListener('click', refreshTrends);

      // Source tabs
      document.querySelectorAll('.tab').forEach(tab => {
        tab.addEventListener('click', () => {
          document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
          tab.classList.add('active');
          renderTrends(tab.dataset.src);
        });
      });

      // Platform buttons
      document.querySelectorAll('.platform-btn').forEach(btn => {
        btn.addEventListener('click', () => {
          document.querySelectorAll('.platform-btn').forEach(b => b.classList.remove('active'));
          btn.classList.add('active');
          state.platform = btn.dataset.platform;
        });
      });

      // Generate button
      document.getElementById('btnGenerate').addEventListener('click', generateContent);

      // Copy button
      document.getElementById('btnCopy').addEventListener('click', copyContent);

      // Settings modal
      document.getElementById('btnSettings').addEventListener('click', () => {
        document.getElementById('inputApiKey').value = state.apiKey;
        document.getElementById('modalSettings').classList.add('open');
      });

      document.getElementById('btnCloseSettings').addEventListener('click', () => {
        document.getElementById('modalSettings').classList.remove('open');
      });

      document.getElementById('btnSaveSettings').addEventListener('click', () => {
        const key = document.getElementById('inputApiKey').value.trim();
        state.apiKey = key;
        localStorage.setItem('anthropic_api_key', key);
        document.getElementById('modalSettings').classList.remove('open');
        showToast('Claude API key saved!');
      });

      // Close modal on overlay click
      document.getElementById('modalSettings').addEventListener('click', (e) => {
        if (e.target.id === 'modalSettings') {
          document.getElementById('modalSettings').classList.remove('open');
        }
      });
    });
  </script>
</body>
</html>
