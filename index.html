<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Stitch Intelligence - Content Studio</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet" />
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }

    :root {
      --bg: #0a0a0a;
      --surface: rgba(255,255,255,0.04);
      --surface-hover: rgba(255,255,255,0.08);
      --border: rgba(255,255,255,0.1);
      --text: #fff;
      --text-secondary: rgba(255,255,255,0.6);
      --text-muted: rgba(255,255,255,0.35);
      --accent: #0A84FF;
      --gold: #C9A962;
      --green: #30D158;
    }

    html, body {
      height: 100vh;
      overflow: hidden;
      background: var(--bg);
      color: var(--text);
      font-family: 'Inter', -apple-system, sans-serif;
      -webkit-font-smoothing: antialiased;
    }

    .app {
      height: 100vh;
      display: grid;
      grid-template-rows: auto 1fr;
    }

    /* Header */
    header {
      padding: 16px 24px;
      border-bottom: 1px solid var(--border);
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .logo {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .logo-mark {
      width: 36px;
      height: 36px;
      background: linear-gradient(135deg, var(--gold), #E8D5A3);
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      font-size: 18px;
      color: #000;
    }

    .logo-text {
      font-size: 18px;
      font-weight: 600;
      letter-spacing: -0.02em;
    }

    .logo-text span {
      color: var(--gold);
    }

    .header-actions {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .worker-status {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 12px;
      color: var(--text-muted);
      padding: 6px 12px;
      background: var(--surface);
      border-radius: 6px;
    }

    .status-dot {
      width: 6px;
      height: 6px;
      border-radius: 50%;
      background: var(--green);
    }

    .status-dot.offline { background: var(--text-muted); }

    .btn {
      padding: 8px 16px;
      border-radius: 8px;
      font-size: 13px;
      font-weight: 500;
      cursor: pointer;
      border: 1px solid var(--border);
      background: var(--surface);
      color: var(--text);
      font-family: inherit;
      transition: all 0.15s;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .btn:hover { background: var(--surface-hover); }
    .btn-gold { background: var(--gold); color: #000; border-color: var(--gold); font-weight: 600; }
    .btn-gold:hover { background: #D4B876; }

    /* Main Layout */
    .main {
      display: grid;
      grid-template-columns: 380px 1fr;
      overflow: hidden;
    }

    /* Sidebar - Topics */
    .sidebar {
      border-right: 1px solid var(--border);
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }

    .sidebar-header {
      padding: 16px;
      border-bottom: 1px solid var(--border);
    }

    .sidebar-title {
      font-size: 11px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.1em;
      color: var(--text-muted);
      margin-bottom: 12px;
    }

    .category-tabs {
      display: flex;
      gap: 6px;
      flex-wrap: wrap;
    }

    .cat-tab {
      padding: 6px 10px;
      font-size: 11px;
      font-weight: 500;
      border-radius: 6px;
      cursor: pointer;
      background: var(--surface);
      color: var(--text-secondary);
      border: 1px solid transparent;
      font-family: inherit;
      transition: all 0.15s;
    }

    .cat-tab:hover { color: var(--text); background: var(--surface-hover); }
    .cat-tab.active { background: var(--gold); color: #000; }

    .topics-list {
      flex: 1;
      overflow-y: auto;
      padding: 12px;
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .topic-card {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 10px;
      padding: 14px;
      cursor: pointer;
      transition: all 0.15s;
    }

    .topic-card:hover { background: var(--surface-hover); border-color: rgba(255,255,255,0.2); }
    .topic-card.selected { border-color: var(--gold); background: rgba(201,169,98,0.1); }
    .topic-card.generating { opacity: 0.6; pointer-events: none; }

    .topic-category {
      font-size: 10px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      color: var(--gold);
      margin-bottom: 6px;
    }

    .topic-title {
      font-size: 13px;
      font-weight: 500;
      line-height: 1.4;
      margin-bottom: 8px;
    }

    .topic-meta {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 11px;
      color: var(--text-muted);
    }

    .topic-source {
      padding: 2px 6px;
      background: var(--surface);
      border-radius: 4px;
      font-weight: 500;
    }

    /* Content Panel */
    .content-panel {
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }

    .content-header {
      padding: 16px 20px;
      border-bottom: 1px solid var(--border);
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .platform-tabs {
      display: flex;
      gap: 6px;
    }

    .platform-tab {
      padding: 8px 14px;
      font-size: 12px;
      font-weight: 500;
      border-radius: 8px;
      cursor: pointer;
      background: var(--surface);
      color: var(--text-secondary);
      border: 1px solid var(--border);
      font-family: inherit;
      transition: all 0.15s;
    }

    .platform-tab:hover { color: var(--text); }
    .platform-tab.active { background: var(--gold); color: #000; border-color: var(--gold); }

    .content-body {
      flex: 1;
      padding: 20px;
      overflow-y: auto;
    }

    .empty-state {
      height: 100%;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      text-align: center;
      color: var(--text-muted);
    }

    .empty-icon {
      font-size: 48px;
      margin-bottom: 16px;
      opacity: 0.4;
    }

    .empty-text {
      font-size: 14px;
      margin-bottom: 4px;
      color: var(--text-secondary);
    }

    .empty-hint {
      font-size: 12px;
    }

    .content-card {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 12px;
      margin-bottom: 16px;
      overflow: hidden;
    }

    .content-card-header {
      padding: 12px 16px;
      background: rgba(255,255,255,0.02);
      border-bottom: 1px solid var(--border);
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .card-label {
      font-size: 11px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      color: var(--text-muted);
    }

    .content-text {
      padding: 20px;
      font-size: 14px;
      line-height: 1.8;
      white-space: pre-wrap;
    }

    .content-hashtags {
      padding: 14px 20px;
      background: rgba(201,169,98,0.08);
      border-top: 1px solid var(--border);
      font-size: 13px;
      color: var(--gold);
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
    }

    .hashtags-text {
      flex: 1;
      word-break: break-word;
    }

    .copy-all-btn {
      width: 100%;
      padding: 16px;
      font-size: 14px;
      justify-content: center;
    }

    /* Loading */
    .loading {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 40px;
      color: var(--text-secondary);
      gap: 12px;
    }

    .spinner {
      width: 24px;
      height: 24px;
      border: 2px solid var(--border);
      border-top-color: var(--gold);
      border-radius: 50%;
      animation: spin 0.8s linear infinite;
    }

    @keyframes spin { to { transform: rotate(360deg); } }

    /* Toast */
    .toast {
      position: fixed;
      bottom: 24px;
      right: 24px;
      background: var(--green);
      color: #000;
      padding: 12px 20px;
      border-radius: 10px;
      font-size: 13px;
      font-weight: 600;
      opacity: 0;
      transform: translateY(10px);
      transition: all 0.3s;
      z-index: 1000;
    }

    .toast.show { opacity: 1; transform: translateY(0); }
    .toast.error { background: #FF453A; color: #fff; }

    /* Settings Modal */
    .modal-overlay {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.85);
      backdrop-filter: blur(10px);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 100;
    }

    .modal-overlay.open { display: flex; }

    .modal {
      background: #141414;
      border: 1px solid var(--border);
      border-radius: 16px;
      padding: 24px;
      width: 440px;
      max-width: 90vw;
    }

    .modal h3 {
      font-size: 18px;
      margin-bottom: 8px;
    }

    .modal p {
      font-size: 13px;
      color: var(--text-secondary);
      line-height: 1.5;
      margin-bottom: 20px;
    }

    .modal code {
      background: var(--surface);
      padding: 2px 6px;
      border-radius: 4px;
      font-size: 12px;
    }

    .form-group {
      margin-bottom: 16px;
    }

    .form-group label {
      display: block;
      font-size: 11px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      color: var(--text-secondary);
      margin-bottom: 8px;
    }

    .form-group input {
      width: 100%;
      padding: 12px;
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 8px;
      color: var(--text);
      font-size: 14px;
      font-family: inherit;
    }

    .form-group input:focus {
      outline: none;
      border-color: var(--gold);
    }

    .modal-actions {
      display: flex;
      gap: 10px;
      margin-top: 20px;
    }

    .modal-actions .btn {
      flex: 1;
      justify-content: center;
      padding: 12px;
    }

    ::-webkit-scrollbar { width: 6px; }
    ::-webkit-scrollbar-track { background: transparent; }
    ::-webkit-scrollbar-thumb { background: var(--border); border-radius: 3px; }
  </style>
</head>
<body>
  <div class="app">
    <header>
      <div class="logo">
        <div class="logo-mark">S</div>
        <div class="logo-text">Stitch <span>Intelligence</span></div>
      </div>
      <div class="header-actions">
        <div class="worker-status">
          <span class="status-dot" id="statusDot"></span>
          <span id="statusText">Checking...</span>
        </div>
        <button class="btn" id="btnSettings">âš™ï¸ Setup</button>
        <button class="btn" id="btnRefresh">â†» Refresh</button>
      </div>
    </header>

    <div class="main">
      <div class="sidebar">
        <div class="sidebar-header">
          <div class="sidebar-title">Trending Topics</div>
          <div class="category-tabs">
            <button class="cat-tab active" data-cat="all">All</button>
            <button class="cat-tab" data-cat="fashion">Fashion</button>
            <button class="cat-tab" data-cat="watches">Watches</button>
            <button class="cat-tab" data-cat="lifestyle">Lifestyle</button>
            <button class="cat-tab" data-cat="style">Style Icons</button>
          </div>
        </div>
        <div class="topics-list" id="topicsList">
          <div class="loading">
            <div class="spinner"></div>
            <span>Loading trends...</span>
          </div>
        </div>
      </div>

      <div class="content-panel">
        <div class="content-header">
          <div class="platform-tabs">
            <button class="platform-tab active" data-platform="linkedin">ğŸ’¼ LinkedIn</button>
            <button class="platform-tab" data-platform="instagram">ğŸ“¸ Instagram</button>
            <button class="platform-tab" data-platform="facebook">ğŸ‘¥ Facebook</button>
            <button class="platform-tab" data-platform="blog">ğŸ“ Blog</button>
          </div>
        </div>
        <div class="content-body" id="contentBody">
          <div class="empty-state">
            <div class="empty-icon">âœ¨</div>
            <div class="empty-text">Select a trending topic</div>
            <div class="empty-hint">AI will generate unique content for each platform</div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Settings Modal -->
  <div class="modal-overlay" id="settingsModal">
    <div class="modal">
      <h3>Content Generator Setup</h3>
      <p>Enter your Cloudflare Worker URL. Deploy the worker from <code>/cloudflare-worker</code> folder, then paste the URL here.</p>
      <div class="form-group">
        <label>Worker URL</label>
        <input type="url" id="workerUrl" placeholder="https://stitch-content-generator.YOUR-SUBDOMAIN.workers.dev">
      </div>
      <div class="modal-actions">
        <button class="btn" id="btnCancelSettings">Cancel</button>
        <button class="btn btn-gold" id="btnSaveSettings">Save & Test</button>
      </div>
    </div>
  </div>

  <div class="toast" id="toast"></div>

  <script>
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // STATE
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    const state = {
      workerUrl: localStorage.getItem('worker_url') || '',
      topics: [],
      selectedTopic: null,
      platform: 'linkedin',
      content: {},
      category: 'all'
    };

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // TREND SOURCES - Men's Luxury Lifestyle
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    const SOURCES = {
      fashion: [
        'mens fashion trends',
        'bespoke suit style',
        'designer menswear',
        'fashion week mens'
      ],
      watches: [
        'luxury watches news',
        'Rolex Patek Philippe',
        'watch collector',
        'horology trends'
      ],
      lifestyle: [
        'luxury cars lifestyle',
        'gentleman lifestyle',
        'luxury gadgets tech',
        'premium accessories'
      ],
      style: [
        'celebrity mens style',
        'athlete fashion',
        'best dressed men',
        'red carpet mens fashion'
      ]
    };

    const CATEGORY_LABELS = {
      fashion: 'ğŸ‘” Fashion',
      watches: 'âŒš Watches',
      lifestyle: 'ğŸš— Lifestyle',
      style: 'â­ Style Icons'
    };

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // FETCH TOPICS
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    async function fetchGoogleNews(query, category) {
      const results = [];
      try {
        const url = `https://news.google.com/rss/search?q=${encodeURIComponent(query)}&hl=en-US&gl=US&ceid=US:en`;
        const res = await fetch(`https://corsproxy.io/?${encodeURIComponent(url)}`);
        if (res.ok) {
          const text = await res.text();
          const parser = new DOMParser();
          const xml = parser.parseFromString(text, 'text/xml');
          xml.querySelectorAll('item').forEach((item, i) => {
            if (i < 2) {
              const title = (item.querySelector('title')?.textContent || '').replace(/ - .*$/, '');
              if (title.length > 20) {
                results.push({
                  title,
                  category,
                  source: 'Google News',
                  time: 'Today'
                });
              }
            }
          });
        }
      } catch (e) {
        console.warn('News fetch failed:', query);
      }
      return results;
    }

    async function fetchReddit(subreddit, category) {
      const results = [];
      try {
        const res = await fetch(`https://www.reddit.com/r/${subreddit}/hot.json?limit=3`);
        if (res.ok) {
          const data = await res.json();
          data.data.children.forEach(post => {
            if (!post.data.stickied && post.data.title.length > 20) {
              results.push({
                title: post.data.title,
                category,
                source: `r/${subreddit}`,
                time: 'Trending',
                score: post.data.score
              });
            }
          });
        }
      } catch (e) {
        console.warn('Reddit fetch failed:', subreddit);
      }
      return results;
    }

    async function fetchAllTopics() {
      const allTopics = [];

      // Fetch from multiple sources
      const fetches = [
        // Fashion
        fetchGoogleNews('mens fashion trends 2024', 'fashion'),
        fetchGoogleNews('bespoke tailoring style', 'fashion'),
        fetchReddit('malefashionadvice', 'fashion'),

        // Watches
        fetchGoogleNews('luxury watches Rolex Omega', 'watches'),
        fetchReddit('Watches', 'watches'),

        // Lifestyle
        fetchGoogleNews('luxury cars lifestyle', 'lifestyle'),
        fetchGoogleNews('premium gadgets', 'lifestyle'),

        // Style Icons
        fetchGoogleNews('celebrity mens style red carpet', 'style'),
        fetchGoogleNews('athlete fashion NBA', 'style')
      ];

      const results = await Promise.all(fetches);
      results.forEach(r => allTopics.push(...r));

      // Deduplicate and sort
      const seen = new Set();
      const unique = allTopics.filter(t => {
        const key = t.title.toLowerCase().slice(0, 40);
        if (seen.has(key)) return false;
        seen.add(key);
        return true;
      });

      // Sort by score if available, otherwise keep order
      unique.sort((a, b) => (b.score || 50) - (a.score || 50));

      return unique.slice(0, 12);
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // RENDER TOPICS
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    function renderTopics() {
      const list = document.getElementById('topicsList');
      let topics = state.topics;

      if (state.category !== 'all') {
        topics = topics.filter(t => t.category === state.category);
      }

      if (topics.length === 0) {
        list.innerHTML = `<div class="empty-state" style="padding:40px;"><div class="empty-hint">No topics in this category</div></div>`;
        return;
      }

      list.innerHTML = topics.map((t, i) => `
        <div class="topic-card ${state.selectedTopic === i ? 'selected' : ''}" data-index="${i}">
          <div class="topic-category">${CATEGORY_LABELS[t.category] || t.category}</div>
          <div class="topic-title">${t.title}</div>
          <div class="topic-meta">
            <span class="topic-source">${t.source}</span>
            <span>${t.time}</span>
          </div>
        </div>
      `).join('');

      list.querySelectorAll('.topic-card').forEach(card => {
        card.onclick = () => selectTopic(parseInt(card.dataset.index));
      });
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // SELECT TOPIC & GENERATE
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    async function selectTopic(index) {
      if (!state.workerUrl) {
        document.getElementById('settingsModal').classList.add('open');
        return;
      }

      state.selectedTopic = index;
      state.content = {};
      renderTopics();

      const topic = state.topics[index];

      document.getElementById('contentBody').innerHTML = `
        <div class="loading">
          <div class="spinner"></div>
          <span>Generating content for all platforms...</span>
        </div>
      `;

      // Generate for all platforms
      const platforms = ['linkedin', 'instagram', 'facebook', 'blog'];

      for (const platform of platforms) {
        try {
          const res = await fetch(state.workerUrl, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
              topic: topic.title,
              category: topic.category,
              platform
            })
          });

          if (res.ok) {
            const data = await res.json();
            state.content[platform] = data;
          } else {
            state.content[platform] = { text: 'Failed to generate. Check worker setup.', hashtags: '' };
          }
        } catch (e) {
          state.content[platform] = { text: 'Error connecting to worker. Check URL.', hashtags: '' };
        }
      }

      renderContent();
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // RENDER CONTENT
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    function renderContent() {
      const content = state.content[state.platform];
      if (!content) {
        document.getElementById('contentBody').innerHTML = `
          <div class="empty-state">
            <div class="empty-icon">â³</div>
            <div class="empty-text">Generating...</div>
          </div>
        `;
        return;
      }

      const platformNames = {
        linkedin: 'ğŸ’¼ LinkedIn Post',
        instagram: 'ğŸ“¸ Instagram Caption',
        facebook: 'ğŸ‘¥ Facebook Post',
        blog: 'ğŸ“ Blog Article'
      };

      document.getElementById('contentBody').innerHTML = `
        <div class="content-card">
          <div class="content-card-header">
            <span class="card-label">${platformNames[state.platform]}</span>
            <button class="btn" onclick="copyText()">ğŸ“‹ Copy</button>
          </div>
          <div class="content-text">${content.text || ''}</div>
          ${content.hashtags ? `
            <div class="content-hashtags">
              <span class="hashtags-text">${content.hashtags}</span>
              <button class="btn" onclick="copyHashtags()">ğŸ“‹</button>
            </div>
          ` : ''}
        </div>
        <button class="btn btn-gold copy-all-btn" onclick="copyAll()">
          ğŸ“‹ Copy Everything â€” Ready to Post
        </button>
      `;
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // COPY FUNCTIONS
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    function copyText() {
      const c = state.content[state.platform];
      if (c?.text) {
        navigator.clipboard.writeText(c.text);
        showToast('Text copied!');
      }
    }

    function copyHashtags() {
      const c = state.content[state.platform];
      if (c?.hashtags) {
        navigator.clipboard.writeText(c.hashtags);
        showToast('Hashtags copied!');
      }
    }

    function copyAll() {
      const c = state.content[state.platform];
      if (c) {
        const full = c.text + (c.hashtags ? '\n\n' + c.hashtags : '');
        navigator.clipboard.writeText(full);
        showToast('Copied to clipboard!');
      }
    }

    function showToast(msg, isError = false) {
      const toast = document.getElementById('toast');
      toast.textContent = msg;
      toast.className = `toast show ${isError ? 'error' : ''}`;
      setTimeout(() => toast.classList.remove('show'), 2500);
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // WORKER STATUS
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    async function checkWorkerStatus() {
      const dot = document.getElementById('statusDot');
      const text = document.getElementById('statusText');

      if (!state.workerUrl) {
        dot.classList.add('offline');
        text.textContent = 'Not configured';
        return;
      }

      try {
        const res = await fetch(state.workerUrl, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ topic: 'test', platform: 'linkedin' })
        });

        if (res.ok) {
          dot.classList.remove('offline');
          text.textContent = 'Connected';
        } else {
          dot.classList.add('offline');
          text.textContent = 'Error';
        }
      } catch (e) {
        dot.classList.add('offline');
        text.textContent = 'Offline';
      }
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // INIT
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    async function init() {
      checkWorkerStatus();

      state.topics = await fetchAllTopics();
      renderTopics();
    }

    document.addEventListener('DOMContentLoaded', () => {
      init();

      // Refresh
      document.getElementById('btnRefresh').onclick = async () => {
        document.getElementById('topicsList').innerHTML = `<div class="loading"><div class="spinner"></div><span>Loading...</span></div>`;
        state.topics = await fetchAllTopics();
        state.selectedTopic = null;
        state.content = {};
        renderTopics();
        document.getElementById('contentBody').innerHTML = `<div class="empty-state"><div class="empty-icon">âœ¨</div><div class="empty-text">Select a trending topic</div></div>`;
      };

      // Category tabs
      document.querySelectorAll('.cat-tab').forEach(tab => {
        tab.onclick = () => {
          document.querySelectorAll('.cat-tab').forEach(t => t.classList.remove('active'));
          tab.classList.add('active');
          state.category = tab.dataset.cat;
          renderTopics();
        };
      });

      // Platform tabs
      document.querySelectorAll('.platform-tab').forEach(tab => {
        tab.onclick = () => {
          document.querySelectorAll('.platform-tab').forEach(t => t.classList.remove('active'));
          tab.classList.add('active');
          state.platform = tab.dataset.platform;
          if (Object.keys(state.content).length > 0) renderContent();
        };
      });

      // Settings modal
      document.getElementById('btnSettings').onclick = () => {
        document.getElementById('workerUrl').value = state.workerUrl;
        document.getElementById('settingsModal').classList.add('open');
      };

      document.getElementById('btnCancelSettings').onclick = () => {
        document.getElementById('settingsModal').classList.remove('open');
      };

      document.getElementById('btnSaveSettings').onclick = async () => {
        const url = document.getElementById('workerUrl').value.trim();
        state.workerUrl = url;
        localStorage.setItem('worker_url', url);
        document.getElementById('settingsModal').classList.remove('open');
        await checkWorkerStatus();
        showToast('Settings saved!');
      };

      document.getElementById('settingsModal').onclick = (e) => {
        if (e.target.id === 'settingsModal') {
          document.getElementById('settingsModal').classList.remove('open');
        }
      };
    });
  </script>
</body>
</html>
